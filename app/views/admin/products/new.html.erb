<div class="md:w-2/3 w-full">
  <h1 class="font-bold text-4xl">New Product</h1>

  <%= form_with model: [:admin, @product], local: true, multipart: true, class: "contents" do |f| %>

    <!-- NAME -->
    <div class="my-5">
      <%= f.label :name %>
      <%= f.text_field :name, class: "block shadow rounded-md border border-gray-200 px-3 py-2 mt-2 w-full" %>
    </div>

    <!-- DESCRIPTION -->
    <div class="my-5">
      <%= f.label :description %>
      <%= f.text_area :description, rows: 4,
          class: "block shadow rounded-md border border-gray-200 px-3 py-2 mt-2 w-full" %>
    </div>

    <!-- imagem -->
    <div class="my-5">
      <%= f.label :image %><br>

      <input id="product_image"
             type="file"
             name="product[images][]"
             multiple
             accept="image/*"
             class="hidden">

      <button type="button"
              onclick="document.getElementById('product_image').click()"
              class="rounded-md bg-gray-100 border px-3 py-1.5 text-sm">
        Procurar
      </button>

      <span id="image-status" class="text-sm text-gray-500">
        Adicionar imagem
      </span>

      <div id="image-preview-container" class="mt-2 hidden">
        <img id="image-preview" class="w-20 h-20 object-cover rounded-md border">
      </div>
    </div>

    <!-- PRICE -->
    <div class="my-5">
      <%= f.label :price %>
      <%= f.number_field :price, step: 0.01,
          class: "block shadow rounded-md border px-3 py-2 mt-2 w-full" %>
    </div>

    <!-- CATEGORY -->
    <div class="my-5">
      <%= f.label :category_id, "Category" %>
      <%= f.collection_select :category_id, @categories, :id, :name,
          { prompt: "Select a category" },
          class: "block shadow rounded-md border px-3 py-2 mt-2 w-full" %>
    </div>

    <!-- ACTIVE -->
    <div class="my-5 flex items-center">
      <%= f.check_box :active %>
      <%= f.label :active, class: "ml-2 text-sm" %>
    </div>

    <%= f.submit "Create Product",
        class: "rounded-lg py-3 px-5 bg-blue-600 text-white font-medium" %>

  <% end %>

  <%= link_to "Back to Products",
      admin_products_path,
      class: "ml-2 rounded-lg py-3 px-5 bg-gray-100 inline-block font-medium" %>
</div>

<script>
document.addEventListener("change", function(e){
  if(e.target.id === "product_image"){
    const file = e.target.files[0]
    if(!file) return

    document.getElementById("image-status").innerText = file.name
    document.getElementById("image-preview").src = URL.createObjectURL(file)
    document.getElementById("image-preview-container").classList.remove("hidden")
  }
})
</script>